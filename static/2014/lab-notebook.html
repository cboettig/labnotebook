<!DOCTYPE html>
<html lang="en" xmlns="https://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: https://purl.org/dc/terms/ og: https://ogp.me/ns#"> <!-- namespaces used in metadata.html -->
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="https://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="https://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="https://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="https://ogp.me/ns/article#published_time" content="" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="https://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<!--
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content=""/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>
-->
<!--NOTE: see also the COinS Metadata in span element in footer -->




  <link rel="stylesheet" href="/assets/css/bootstrap.min.css" type="text/css"/>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="/assets/css/academicons.css" />
  <!-- Help the browser identify the RSS feed automatically -->
  <link rel="alternate" type="application/rss+xml" title="Carl Boettiger's Lab Notebook" href="/blog.xml" />
</head>


  <body prefix="dc: https://purl.org/dc/terms/ foaf: https://xmlns.com/foaf/0.1/"> 
    <!-- Navbar  ================================================== -->

<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/README.html"><i class="icon-info-sign"></i></a>
    </div>

 <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

          <li  >
          <a href="/index.html">Home</a></li>
          <li  >
          <a href="/vita.html">Vita</a></li>
          <li  >
          <a href="/research.html">Research</a></li>
          <li  >
          <a href="/teaching.html">Teaching</a></li>
          <li  >
          <a href="/community.html">Community</a></li>
          <li  class="active" >
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>

      <!-- Search site using Google's index -->
        <form class="navbar-form navbar-right" role="search" method="get" action="https://google.com/search">
          <div class="form-group">
            <input type="hidden" name="q" value="site:carlboettiger.info" />
            <input type="text" class="form-control search-query" name="q" placeholder="Search"/>
          </div>
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
       </form>

    </div><!--/.nav-collapse -->
  </div> <!-- /container -->
</nav>



    <div class="container"> <!-- Responsive grid layout, doesn't jump to full-width --> 
      <header>
        <h1 class="entry-title">Lab Notebook</h1>
        <h2>(<a href="https://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h2>
      </header>

      <div class="row postpreview">
  <div class="col-md-11 col-md-offset-1">
    <div class="row">
			<h4> <a href="/2014/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//12/11/rrhack-notes.html">Rrhack Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 11 Dec 2014</p>

<article>
<div class="excerpt">
<p>Misc notes from #rrhack. Much more detail under our <a href="https://github.com/Reproducible-Science-Curriculum">Github organization</a>, including the issues tracker &amp; wiki for the meeting and the start of the repositories for the various teaching modules.</p>
<p>Also see rrhack slack forum and twitter hashtag.</p>
<h2 id="key-questions">Key questions</h2>
<ul>
<li><p>Audience and motivation. Reproducibility isn’t a goal, it’s a means to an ends. Accelerating science is the goal. Motivation should be to accelerate &amp; scale your own science.</p></li>
<li><p>Reproducible by whom? Starting point: expert in domain, expert in language can reproduce without the need to rediscover / recreate? Better: agonstic to language?</p></li>
<li><p>Complexity. How frequently does routine, non-computational research involve writing over 1000 lines of code? Can 1000 lines of code be managed successfully without a software development approach?</p></li>
<li><p>knitr &amp; scaling issues</p></li>
<li><p>The download file problem.</p></li>
</ul>
<h2 id="mine-on-using-docker">Mine on using Docker</h2>
<ul>
<li>Docker installed on cluster</li>
<li>Students use RStudio export function to download &amp; submit (into a standard course management platform). import data via direct calls from R (e.g. <code>download.file()</code>)</li>
</ul>
<h2 id="jenny-bryan-on-on-using-github-to-teach">Jenny Bryan on on using Github to teach</h2>
<ul>
<li>Free organization account (gold) with 50 private repos</li>
<li>Prof / TA team has write access</li>
<li>Each student needs to be their own team with write access to own repo</li>
<li>Student team has read access to everything, so they can see each-others work</li>
</ul>
<p>Homework submission: open an issue in their repo, tag the owners group, include the hash.</p>
<p>Need programmatic control of Github to set this up.<br /> Need alterego to test that this works</p>
<p>Users avoid command line for most work to start, just using Github interface and RStudio interface.</p>
<p>Not happy with Windows version of Github’s git client (hard to connect to RStudio). Not a problem with the mac.</p>
<h2 id="dockerized-rstudio-as-pointy-clicky-application">Dockerized RStudio as pointy-clicky application?</h2>
<p>From Jenny: Desktop launch for docker. from Dan: rewrap boot2docker to launch RStudio (hadleyverse) with a click. (installs virtualbox,docker, &amp; boot2docker first if necessary. 129 MB. Not self contained though?).</p>
<h2 id="new-tricks">New tricks</h2>
<p>Working with multiple branches with different content (e.g. gh-pages): Add a <code>web/</code> subdirectory to repo and .gitignore, check out the gh-pages branch there. Add indicator of branch to user’s prompt.</p>
<p>Using the wiki pages: see [richfitz/ghwiki]. Rather than publish <code>.Rmd</code> files</p>
<p>Organization: just stick with package compendium format?</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//12/11/rrhack-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//12/07/self-destroy-droplet-on-completion.html">Self Destroy Droplet On Completion</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 07 Dec 2014</p>

<article>
<div class="excerpt">
<p>Scott’s analogsea package provides a great way to script commands for cloud instances on the digitalocean platform. for instance, we can use analogsea to automatically start an instance of the desired size, submit a computationally intensive task, and then terminate the instance when the task completes successfully. This last step is particularly convenient since it makes it easier to use a very powerful (and thus expensive) instance for a short time, knowing it will terminate and avoid extra charges while idle.</p>
<p>To avoid first having to install the necessary software environment on the newly created digitalocean instance, we will simply pull a docker image that has already been provisioned. This is particularly useful in both keeping what we information we need to send to the cloud machine consise (no need to list all dependencies) and fast (particularly in the case of installing any packages from source, such as R packages from CRAN. Thee complete installation process to generate the image we use here can take over an hour itself).</p>
<p>The analogsea package provides nice functions for working with docker as well, as we will illustrate here.</p>
<p>First, we can define a custom little function that will pull a given Github repo, run the script specified, and push the results back up.</p>
<pre class="sourceCode r"><code class="sourceCode r">task &lt;-<span class="st"> </span>function(REPO, PATH, SCRIPT, <span class="dt">USER =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;USER&quot;</span>), 
                 <span class="dt">GH_TOKEN =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;GH_TOKEN&quot;</span>), 
                 <span class="dt">EMAIL =</span> <span class="kw">paste0</span>(USER, <span class="st">&quot;@&quot;</span>, USER, <span class="st">&quot;.com&quot;</span>),
                 <span class="dt">IMG =</span> <span class="st">&quot;rocker/hadleyverse&quot;</span>){
  <span class="kw">paste</span>(
  <span class="kw">paste0</span>(<span class="st">&quot;-it &quot;</span>, IMG, <span class="st">&quot; bash -c </span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;git config --global user.name &quot;</span>, USER),
  <span class="kw">paste0</span>(<span class="st">&quot;git config --global user.email &quot;</span>, EMAIL),
  <span class="kw">paste0</span>(<span class="st">&quot;git clone &quot;</span>, <span class="st">&quot;https://&quot;</span>, USER, <span class="st">&quot;:&quot;</span>, GH_TOKEN, <span class="st">&quot;@github.com/&quot;</span>, USER, <span class="st">&quot;/&quot;</span>, REPO, <span class="st">&quot;.git&quot;</span>),
  <span class="kw">paste0</span>(<span class="st">&quot;cd &quot;</span>, REPO),
  <span class="kw">paste0</span>(<span class="st">&quot;cd &quot;</span>, PATH),
  <span class="kw">paste0</span>(<span class="st">&quot;Rscript &quot;</span>, SCRIPT),
  <span class="st">&quot;git add -A&quot;</span>,
  <span class="st">&quot;git commit -a -m &#39;runs from droplet&#39;&quot;</span>,
  <span class="st">&quot;git push origin master&quot;</span>,
  <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>,
  <span class="dt">sep=</span><span class="st">&quot;; &quot;</span>)
}</code></pre>
<p>This could probably be made a bit more elegant, but the idea is simple. Note that we will clone over https, assuming a Github authentication token is available in the environment (e.g. in <code>.Rprofile</code>) as <code>GH_TOKEN</code>.</p>
<p>To use this function to run the script <code>knit.R</code> in the <code>inst/examples</code> directory of my <code>template</code> repo, I do:</p>
<pre class="sourceCode r"><code class="sourceCode r">tsk &lt;-<span class="st"> </span><span class="kw">task</span>(<span class="st">&quot;template&quot;</span>, <span class="st">&quot;inst/examples&quot;</span>, <span class="st">&quot;knit.R&quot;</span>, <span class="dt">IMG=</span><span class="st">&quot;cboettig/strata&quot;</span>)</code></pre>
<p>which returns the commands we’ll need to run as a string. In this case I have set a custom docker image <code>cboettig/strata</code> that contains my standard development environment in use on my laptop, strata.</p>
<p>If we have Docker installed on the local system, we can verify this script works locally first:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="kw">paste</span>(<span class="st">&quot;docker run --rm&quot;</span>, tsk))</code></pre>
<p>Now we’re ready for the analogsea part to submit this job to a digitalocean machine which it will create and destroy on the fly. Note that this assumes we have a digitalocean account and have saved a personal authentication token to our environment as <code>DO_PAT</code> (otherwise analogsea will simply prompt us to autheticate manually in the browser). This also requires we have an ssh key added to our account already (at least at this time).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(analogsea)
<span class="kw">docklet_create</span>(<span class="dt">size=</span><span class="st">&#39;512mb&#39;</span>) %&gt;%
<span class="st">  </span><span class="kw">docklet_run</span>(tsk) %&gt;%
<span class="st">  </span><span class="kw">droplet_delete</span>()</code></pre>
<p>analogsea will first create the droplet of the desired size (analogsea refers to digitalocean droplets which have Docker software installed as “docklets”), then run our command and destroy the droplet.</p>
<p>Note that the functions will only continue to the next step if the previous is successful. Consequently, if the script fails for some reason, the instance will perist and we can attempt to debug if we so choose. If we want the instance to be destroyed whether the script succeeds or fails, we can simply drop the last <code>%&gt;%</code> pipe and the destroy command will still run. (Otherwise some error handling would be reuired aroun the <code>docklet_run</code> code tomake sure it continues.</p>
<p>Sometimes the droplet login will fail due to having had a previous digitalocean instance with the same ip (causing ssh to warn that the host identity has changed) or to allow the token to be approved. In this case, it may help to create the the droplet in a separate step, ssh into the ip returned vy <code>droplets()</code> manually outside of R, and then return to R to launch the task:</p>
<pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">droplets</span>()
d[[<span class="dv">2</span>]] %&gt;%<span class="st">  </span>
<span class="st">  </span><span class="kw">docklet_run</span>(tsk) %&gt;%
<span class="st">  </span><span class="kw">droplet_delete</span>()</code></pre>
<p>This assumes our desired droplet is the second in the list (hence <code>d[[2]]</code>).</p>
<p>Of course our R instance needs to persist long enough for the job to complete, so we need to be sure to run this from a machine that will itslef remain up, such as a desktop or even another server.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//12/07/self-destroy-droplet-on-completion.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//12/04/lsn-nimble.html">Lsn Nimble</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 04 Dec 2014</p>

<article>
<div class="excerpt">
<p>some sample data</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sde)
<span class="kw">library</span>(nimble)
<span class="kw">set.seed</span>(<span class="dv">123</span>)
d &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="fl">0.5</span> *<span class="st"> </span>(<span class="dv">10</span>-x))
s &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="dv">1</span>) 
data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">sde.sim</span>(<span class="dt">X0=</span><span class="dv">6</span>,<span class="dt">drift=</span>d, <span class="dt">sigma=</span>s, <span class="dt">T=</span><span class="dv">20</span>, <span class="dt">N=</span><span class="dv">100</span>))</code></pre>
<pre><code>sigma.x not provided, attempting symbolic derivation.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(data)</code></pre>
<figure>
<img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-1-1.svg" />
</figure>
<h2 id="lsn-version">LSN version</h2>
<p>Test case: Set prior for <code>m</code> <span class="math">\(\approx 0\)</span>:</p>
<pre class="sourceCode r"><code class="sourceCode r">lsn &lt;-<span class="st"> </span><span class="kw">modelCode</span>({
   theta ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="fl">100.0</span>)
   sigma_x ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="fl">100.0</span>)
   sigma_y ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="fl">100.0</span>)
       m ~<span class="st"> </span><span class="kw">dunif</span>(-<span class="fl">1e2</span>, <span class="fl">1e2</span>)
    x[<span class="dv">1</span>] ~<span class="st"> </span><span class="kw">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)
    y[<span class="dv">1</span>] ~<span class="st"> </span><span class="kw">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>) 

  for(i in <span class="dv">1</span>:(N<span class="dv">-1</span>)){
    mu_x[i] &lt;-<span class="st"> </span>x[i] +<span class="st"> </span>y[i] *<span class="st"> </span>(theta -<span class="st"> </span>x[i]) 
    x[i<span class="dv">+1</span>] ~<span class="st"> </span><span class="kw">dnorm</span>(mu_x[i], <span class="dt">sd =</span> sigma_x) 
    mu_y[i] &lt;-<span class="st"> </span>y[i] +<span class="st"> </span>m *<span class="st"> </span>t[i]
    y[i<span class="dv">+1</span>] ~<span class="st"> </span><span class="kw">dnorm</span>(mu_y[i], <span class="dt">sd =</span> sigma_y) 
  }
})</code></pre>
<p>Constants in the model definition are the length of the dataset, <span class="math">\(N\)</span> and the time points of the sample. Note we’ve made time explicit, we’ll assume uniform spacing here.</p>
<pre class="sourceCode r"><code class="sourceCode r">constants &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">length</span>(data$x), <span class="dt">t =</span> <span class="dv">1</span>:<span class="kw">length</span>(data$x))</code></pre>
<p>Initial values for the parameters</p>
<pre class="sourceCode r"><code class="sourceCode r">inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">theta =</span> <span class="dv">6</span>, <span class="dt">m =</span> <span class="dv">0</span>, <span class="dt">sigma_x =</span> <span class="dv">1</span>, <span class="dt">sigma_y =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="kw">rep</span>(<span class="dv">1</span>,constants$N))</code></pre>
<p>and here we go as before:</p>
<pre class="sourceCode r"><code class="sourceCode r">Rmodel &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(<span class="dt">code =</span> lsn, 
                      <span class="dt">constants =</span> constants, 
                      <span class="dt">data =</span> data, 
                      <span class="dt">inits =</span> inits)
Cmodel &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(Rmodel)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mcmcspec &lt;-<span class="st"> </span><span class="kw">MCMCspec</span>(Rmodel, <span class="dt">print=</span><span class="ot">TRUE</span>,<span class="dt">thin=</span><span class="fl">1e2</span>)</code></pre>
<pre><code>[1] RW sampler;   targetNode: theta,  adaptive: TRUE,  adaptInterval: 200,  scale: 1
[2] RW sampler;   targetNode: sigma_x,  adaptive: TRUE,  adaptInterval: 200,  scale: 1
[3] RW sampler;   targetNode: sigma_y,  adaptive: TRUE,  adaptInterval: 200,  scale: 1
[4] RW sampler;   targetNode: m,  adaptive: TRUE,  adaptInterval: 200,  scale: 1
[5] RW sampler;   targetNode: y[1],  adaptive: TRUE,  adaptInterval: 200,  scale: 1
[6] conjugate_dnorm sampler;   targetNode: y[2],  dependents_dnorm: x[3], y[3]
...</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">Rmcmc &lt;-<span class="st"> </span><span class="kw">buildMCMC</span>(mcmcspec)
Cmcmc &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(Rmcmc, <span class="dt">project =</span> Cmodel)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Cmcmc</span>(<span class="fl">1e4</span>)</code></pre>
<pre><code>NULL</code></pre>
<p>and examine results</p>
<pre class="sourceCode r"><code class="sourceCode r">samples &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.matrix</span>(<span class="kw">nfVar</span>(Cmcmc, <span class="st">&#39;mvSamples&#39;</span>)))
<span class="kw">dim</span>(samples)</code></pre>
<pre><code>[1] 100 206</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">samples &lt;-<span class="st"> </span>samples[,<span class="dv">1</span>:<span class="dv">4</span>]</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(samples$theta)</code></pre>
<pre><code>[1] 10.11174</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(samples$m)</code></pre>
<pre><code>[1] -1.88765e-05</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(samples$sigma_x)</code></pre>
<pre><code>[1] 0.385018</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(samples[ , <span class="st">&#39;m&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="st">&#39;m&#39;</span>)
<span class="kw">plot</span>(samples[ , <span class="st">&#39;sigma_x&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(sigma[x]))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;sigma_y&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(sigma[y]))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;theta&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(theta))</code></pre>
<p><img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-10-1.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-10-2.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-10-3.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-10-4.svg" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(samples[, <span class="st">&#39;m&#39;</span>], <span class="dt">xlab =</span> <span class="st">&#39;m&#39;</span>)
<span class="kw">hist</span>(samples[, <span class="st">&#39;sigma_x&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(sigma[x]))
<span class="kw">hist</span>(samples[, <span class="st">&#39;sigma_y&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(sigma[y]))
<span class="kw">hist</span>(samples[, <span class="st">&#39;theta&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(theta))</code></pre>
<p><img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-11-1.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-11-2.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-11-3.svg" /> <img src="/2014/assets/figures/posts/2014-12-04-lsn-nimble/unnamed-chunk-11-4.svg" /></p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//12/04/lsn-nimble.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014//12/03/ou-model-in-nimble.html">OU model in Nimble</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 03 Dec 2014</p>

<article>
<div class="excerpt">
<p>Sanity test with a simple model, Start with some sample data from an OU process:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;sde&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;nimble&quot;</span>)
<span class="kw">set.seed</span>(<span class="dv">123</span>)
d &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="fl">0.5</span> *<span class="st"> </span>(<span class="dv">10</span>-x))
s &lt;-<span class="st"> </span><span class="kw">expression</span>(<span class="dv">1</span>) 
data &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">sde.sim</span>(<span class="dt">X0=</span><span class="dv">6</span>,<span class="dt">drift=</span>d, <span class="dt">sigma=</span>s, <span class="dt">T=</span><span class="dv">20</span>, <span class="dt">N=</span><span class="dv">100</span>))</code></pre>
<pre><code>sigma.x not provided, attempting symbolic derivation.</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(data)</code></pre>
<figure>
<img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-2-1.png" />
</figure>
<p>Specify this model in Nimble BUGS code</p>
<pre class="sourceCode r"><code class="sourceCode r">ou &lt;-<span class="st"> </span><span class="kw">modelCode</span>({
   theta ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="fl">100.0</span>)
       r ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="fl">20.0</span>)
   sigma ~<span class="st"> </span><span class="kw">dunif</span>(<span class="fl">1e-10</span>, <span class="dv">100</span>)
    x[<span class="dv">1</span>] ~<span class="st"> </span><span class="kw">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)

  for(t in <span class="dv">1</span>:(N<span class="dv">-1</span>)){
    mu[t] &lt;-<span class="st"> </span>x[t] +<span class="st"> </span>r *<span class="st"> </span>(theta -<span class="st"> </span>x[t]) 
    x[t<span class="dv">+1</span>] ~<span class="st"> </span><span class="kw">dnorm</span>(mu[t], <span class="dt">sd =</span> sigma) 
  }
})</code></pre>
<p>nimble parameters</p>
<pre class="sourceCode r"><code class="sourceCode r">const &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="kw">length</span>(data$x))
ou_inits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">theta =</span> <span class="dv">6</span>, <span class="dt">r =</span> <span class="dv">1</span>, <span class="dt">sigma =</span> <span class="dv">1</span>)</code></pre>
<p>Create, spec, build, &amp; compile</p>
<pre class="sourceCode r"><code class="sourceCode r">ou_Rmodel &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(<span class="dt">code =</span> ou, <span class="dt">constants =</span> const, <span class="dt">data =</span> data, <span class="dt">inits =</span> ou_inits)
ou_spec &lt;-<span class="st"> </span><span class="kw">MCMCspec</span>(ou_Rmodel, <span class="dt">thin=</span><span class="fl">1e2</span>)
ou_Rmcmc &lt;-<span class="st"> </span><span class="kw">buildMCMC</span>(ou_spec)
ou_Cmodel &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(ou_Rmodel)
ou_mcmc &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(ou_Rmcmc, <span class="dt">project =</span> ou_Cmodel)</code></pre>
<p>Run the MCMC</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ou_mcmc</span>(<span class="fl">1e4</span>)</code></pre>
<pre><code>NULL</code></pre>
<p>and examine the results</p>
<pre class="sourceCode r"><code class="sourceCode r">samples &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.matrix</span>(<span class="kw">nfVar</span>(ou_mcmc, <span class="st">&#39;mvSamples&#39;</span>)))
<span class="kw">mean</span>(samples$theta)</code></pre>
<pre><code>[1] 10.47953</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(samples$sigma)</code></pre>
<pre><code>[1] 0.392594</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">means</span>(samples$r)</code></pre>
<pre><code>Error in eval(expr, envir, enclos): could not find function &quot;means&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(samples[ , <span class="st">&#39;r&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(r))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;sigma&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(sigma))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;theta&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(theta))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;r&#39;</span>], samples[ , <span class="st">&#39;sigma&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(r), <span class="dt">ylab =</span> <span class="kw">expression</span>(simga))
<span class="kw">hist</span>(samples[, <span class="st">&#39;theta&#39;</span>])</code></pre>
<p><img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-8-1.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-8-2.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-8-3.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-8-4.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-8-5.png" /></p>
<h3 id="block-sampler">Block sampler</h3>
<pre class="sourceCode r"><code class="sourceCode r">ou_spec$<span class="kw">addSampler</span>(<span class="st">&quot;RW_block&quot;</span>, <span class="kw">list</span>(<span class="dt">targetNodes=</span><span class="kw">c</span>(<span class="st">&#39;r&#39;</span>,<span class="st">&#39;sigma&#39;</span>,<span class="st">&#39;theta&#39;</span>), <span class="dt">adaptInterval=</span><span class="dv">100</span>))</code></pre>
<pre><code>[4] RW_block sampler;   targetNodes: r, sigma, theta,  adaptive: TRUE,  adaptInterval: 100,  scale: 1,  propCov: identity</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ou_Rmcmc2 &lt;-<span class="st"> </span><span class="kw">buildMCMC</span>(ou_spec)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ou_mcmc2 &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(ou_Rmcmc2, <span class="dt">project=</span>ou_Rmodel, <span class="dt">resetFunctions=</span><span class="ot">TRUE</span>)</code></pre>
<p>(not clear why we use the old project here; but seems to allow us to inherit from previous settings, e.g. the monitors from <code>mcmcSpec()</code> initialization)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ou_mcmc2</span>(<span class="fl">1e4</span>)</code></pre>
<pre><code>NULL</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">samples2 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.matrix</span>(<span class="kw">nfVar</span>(ou_mcmc2, <span class="st">&#39;mvSamples&#39;</span>)))
<span class="kw">mean</span>(samples2$theta)</code></pre>
<pre><code>[1] 10.46894</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(samples2[ , <span class="st">&#39;r&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(r))
<span class="kw">plot</span>(samples2[ , <span class="st">&#39;sigma&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(sigma))
<span class="kw">plot</span>(samples2[ , <span class="st">&#39;theta&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>, <span class="dt">ylab =</span> <span class="kw">expression</span>(theta))
<span class="kw">plot</span>(samples2[ , <span class="st">&#39;r&#39;</span>], samples[ , <span class="st">&#39;sigma&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(r), <span class="dt">ylab =</span> <span class="kw">expression</span>(simga))
<span class="kw">hist</span>(samples2[ , <span class="st">&#39;theta&#39;</span>])</code></pre>
<p><img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-13-1.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-13-2.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-13-3.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-13-4.png" /> <img src="/2014/assets/figures/posts/2014-12-03-ou-model-in-nimble/unnamed-chunk-13-5.png" /></p>
<hr />
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//12/03/ou-model-in-nimble.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//12/03/nimble-explore.html">Nimble Explore</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 03 Dec 2014</p>

<article>
<div class="excerpt">
<p>Working through quick-start example in <a href="https://r-nimble.org/manuals/NimbleUserManual.pdf">nimble manual</a></p>
<p>The manual gives essentially no introduction to what appears to be a classic BUGS example model for stochastically failing pumps.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nimble)
pumpCode &lt;-<span class="st"> </span><span class="kw">modelCode</span>({
  for (i in <span class="dv">1</span>:N){
    theta[i] ~<span class="st"> </span><span class="kw">dgamma</span>(alpha,beta)
    lambda[i] &lt;-<span class="st"> </span>theta[i]*t[i]
    x[i] ~<span class="st"> </span><span class="kw">dpois</span>(lambda[i])
  }
  alpha ~<span class="st"> </span><span class="kw">dexp</span>(<span class="fl">1.0</span>)
  beta ~<span class="st"> </span><span class="kw">dgamma</span>(<span class="fl">0.1</span>,<span class="fl">1.0</span>)
})</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pumpConsts &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">N =</span> <span class="dv">10</span>, 
                   <span class="dt">t =</span> <span class="kw">c</span>(<span class="fl">94.3</span>, <span class="fl">15.7</span>, <span class="fl">62.9</span>, <span class="dv">126</span>, <span class="fl">5.24</span>,
                         <span class="fl">31.4</span>, <span class="fl">1.05</span>, <span class="fl">1.05</span>, <span class="fl">2.1</span>, <span class="fl">10.5</span>))
pumpData &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">14</span>, <span class="dv">3</span>, <span class="dv">19</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">22</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pumpInits &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>, 
                  <span class="dt">beta =</span> <span class="dv">1</span>,
                  <span class="dt">theta =</span> <span class="kw">rep</span>(<span class="fl">0.1</span>, pumpConsts$N))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(<span class="dt">code =</span> pumpCode, 
                    <span class="dt">name =</span> <span class="st">&#39;pump&#39;</span>, 
                    <span class="dt">constants =</span> pumpConsts,
                    <span class="dt">data =</span> pumpData, 
                    <span class="dt">inits =</span> pumpInits)

pump$<span class="kw">getNodeNames</span>()</code></pre>
<pre><code> [1] &quot;alpha&quot;               &quot;beta&quot;                &quot;lifted_d1_over_beta&quot;
 [4] &quot;theta[1]&quot;            &quot;theta[2]&quot;            &quot;theta[3]&quot;           
 [7] &quot;theta[4]&quot;            &quot;theta[5]&quot;            &quot;theta[6]&quot;           
[10] &quot;theta[7]&quot;            &quot;theta[8]&quot;            &quot;theta[9]&quot;           
[13] &quot;theta[10]&quot;           &quot;lambda[1]&quot;           &quot;lambda[2]&quot;          
[16] &quot;lambda[3]&quot;           &quot;lambda[4]&quot;           &quot;lambda[5]&quot;          
[19] &quot;lambda[6]&quot;           &quot;lambda[7]&quot;           &quot;lambda[8]&quot;          
[22] &quot;lambda[9]&quot;           &quot;lambda[10]&quot;          &quot;x[1]&quot;               
[25] &quot;x[2]&quot;                &quot;x[3]&quot;                &quot;x[4]&quot;               
[28] &quot;x[5]&quot;                &quot;x[6]&quot;                &quot;x[7]&quot;               
[31] &quot;x[8]&quot;                &quot;x[9]&quot;                &quot;x[10]&quot;              </code></pre>
<p>Note that we can see <code>theta</code> has our initial conditions, while <code>lambda</code> has not yet been initialized:</p>
<pre class="sourceCode r"><code class="sourceCode r">pump$theta</code></pre>
<pre><code> [1] 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump$lambda</code></pre>
<pre><code> [1] NA NA NA NA NA NA NA NA NA NA</code></pre>
<p>Hmm, initially we cannot simulate <code>theta</code> values though (or rather, we just get NaNs and warnings if we do). At the moment I’m not clear on why, though seems to be due to the lifted node:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">simulate</span>(pump, <span class="st">&#39;theta&#39;</span>)
pump$theta</code></pre>
<pre><code> [1] NaN NaN NaN NaN NaN NaN NaN NaN NaN NaN</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump$lifted_d1_over_beta</code></pre>
<pre><code>[1] NA</code></pre>
<p>If we calculate the log probability density of the determinstic dependencies of alpha and beta nodes (i.e. the lifted node) then we’re okay:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">0</span>) ## This makes the simulations here reproducible
<span class="kw">calculate</span>(pump, pump$<span class="kw">getDependencies</span>(<span class="kw">c</span>(<span class="st">&#39;alpha&#39;</span>, <span class="st">&#39;beta&#39;</span>), <span class="dt">determOnly =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>[1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">simulate</span>(pump, <span class="st">&#39;theta&#39;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump$theta</code></pre>
<pre><code> [1] 1.79180692 0.29592523 0.08369014 0.83617765 1.22254365 1.15835525
 [7] 0.99001994 0.30737332 0.09461909 0.15720154</code></pre>
<p>We still need to initialize lambda, e.g. by calculating the probability density on those nodes:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">calculate</span>(pump, <span class="st">&#39;lambda&#39;</span>)</code></pre>
<pre><code>[1] 0</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump$lambda</code></pre>
<pre><code> [1] 168.9673926   4.6460261   5.2641096 105.3583839   6.4061287
 [6]  36.3723548   1.0395209   0.3227420   0.1987001   1.6506161</code></pre>
<p>though not entirely clear to me why the guide prefers to do this as the dependencies of theta (which clearly include lambda, but also other things). Also not clear if these <code>calculate</code> steps are necessary to proceed with the <code>MCMCspec</code> and <code>buildMCMC</code>, or compile steps. Let’s reset the model<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> and find out:</p>
<pre class="sourceCode r"><code class="sourceCode r">pump &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(<span class="dt">code =</span> pumpCode, 
                    <span class="dt">name =</span> <span class="st">&#39;pump&#39;</span>, 
                    <span class="dt">constants =</span> pumpConsts,
                    <span class="dt">data =</span> pumpData, 
                    <span class="dt">inits =</span> pumpInits)

pump$theta</code></pre>
<pre><code> [1] 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pump$lambda</code></pre>
<pre><code> [1] NA NA NA NA NA NA NA NA NA NA</code></pre>
<p>Good, we’re reset. Now we try:</p>
<pre class="sourceCode r"><code class="sourceCode r">Cpump &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(pump)
pumpSpec &lt;-<span class="st"> </span><span class="kw">MCMCspec</span>(pump)
pumpSpec$<span class="kw">addMonitors</span>(<span class="kw">c</span>(<span class="st">&#39;alpha&#39;</span>, <span class="st">&#39;beta&#39;</span>, <span class="st">&#39;theta&#39;</span>))</code></pre>
<pre><code>thin = 1: alpha, beta, theta</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">pumpMCMC &lt;-<span class="st"> </span><span class="kw">buildMCMC</span>(pumpSpec)
CpumpMCMC &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(pumpMCMC, <span class="dt">project =</span> pump)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CpumpMCMC</span>(<span class="dv">1000</span>)</code></pre>
<pre><code>NULL</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">samples &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">nfVar</span>(CpumpMCMC, <span class="st">&#39;mvSamples&#39;</span>))</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(samples[ , <span class="st">&#39;alpha&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>,
<span class="dt">ylab =</span> <span class="kw">expression</span>(alpha))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;beta&#39;</span>], <span class="dt">type =</span> <span class="st">&#39;l&#39;</span>, <span class="dt">xlab =</span> <span class="st">&#39;iteration&#39;</span>,
<span class="dt">ylab =</span> <span class="kw">expression</span>(beta))
<span class="kw">plot</span>(samples[ , <span class="st">&#39;alpha&#39;</span>], samples[ , <span class="st">&#39;beta&#39;</span>], <span class="dt">xlab =</span> <span class="kw">expression</span>(alpha),
<span class="dt">ylab =</span> <span class="kw">expression</span>(beta))</code></pre>
<p><img src="/2014/assets/figures/posts/2014-12-03-nimble-explore/unnamed-chunk-15-1.png" /> <img src="/2014/assets/figures/posts/2014-12-03-nimble-explore/unnamed-chunk-15-2.png" /> <img src="/2014/assets/figures/posts/2014-12-03-nimble-explore/unnamed-chunk-15-3.png" /></p>
<p>Note the poor mixing (which is improved by the block sampler, as shown in the manual).</p>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Not completely certain that this destroys anything connected to the object as C pointers from before, but seems like it should.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//12/03/nimble-explore.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//11/26/coreos-cluster-gotchas.html">Coreos Cluster Gotchas</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 26 Nov 2014</p>

<article>
<div class="excerpt">
<p>Overall impression is that CoreOS is a promising way to easily set up a highly available cluster (e.g. when most important thing is that a service stays up when a node goes down) since it can migrate a containerized app to a new machine rather than having to already have the same app running on all machines. Either way a load-balancer needs to handle the addressing, which is do-able but somewhat tricky.</p>
<p>Less useful in the role of a simple server; as admin on the base system is somewhat more limited (e.g. network stats, NFS sharing, etc), and more pointedly I seem to continually run afoul of stability issues in Fleet when cluster changes size, with no way to recover without destroying and relaunching the entire cluster.</p>
<p>The most compelling features for me, the automated updating and the restarting containers on system reboot, can be replicated rather straight forwardly on a normal distribution.</p>
<p>Fleet cannot pick a leader in a cluster of size 2 (no majority) and fails when CoreOS loses a majority. A cluster of size 3 can replace 1 node, but if 2 nodes fail, the cluster is hosed. See <a href="https://coreos.com/docs/cluster-management/scaling/etcd-optimal-cluster-size/">optimal cluster size</a> and <a href="https://github.com/coreos/etcd/issues/863#issuecomment-60523183">etcd/issues/863</a>. Rescaling may assign the new node a new address, and the majority must approve the new peer. If there’s not a majority available (e.g. cluster goes from 3 to 1) you’re stuck.</p>
<p>In the etcd &gt; 0.5.0 (alpha channel now methinks) some recovery is possible, see: <a href="https://github.com/coreos/etcd/issues/1242">etcd/issues/1242</a></p>
<p>On Amazon, CoreOS provides ability to launch an AWS auto-scaling group as a CloudFormation configuration, which can set a minimum cluster size and always restart when a node goes down. Setting the minumum below 3 results in an invalid cluster (failed etcd connection due to lacking majority) and needs to be destroyed. Need to destroy the autoscaling group, cannot simply remove instances (since they will be regenerated). Also remember to adjust the security groups to set outside access for the appropriate service ports.</p>
<p>Persistant URL address is challenging when nodes keep changing. If one node is guarenteed to be up, we can have it run the nginx load balancer to redirect to the other nodes (using toml nginx templates).</p>
<hr />
<h3 id="coreos-docker-part-ways">CoreOS &amp; Docker part ways?</h3>
<p>Update: and <a href="https://coreos.com/blog/rocket/">now it seems CoreOS isn’t happy with Docker and seeks to invent their own runtime</a>… time will tell if it gets critical mass to be viable, but doesn’t seem like it is well aligned with my own use cases of quickly deploying basic services (RStudio, Gitlab, Drone, Docker Registry).</p>
<p>Also, lots of competition/ecosystem for container orchistration alternatives to fleet/CoreOS, though the use case for many of these isn’t entirely clear for my needs. In particular, see:</p>
<ul>
<li><a href="https://aws.amazon.com/ecs/">Amazon’s container service</a></li>
<li><a href="https://github.com/GoogleCloudPlatform/kubernetes">Google’s container service</a></li>
<li>and of course, Docker’s own fig.org.</li>
</ul>
<p>Again all seem to emphasize more the stable, complex service model in the cloud and aren’t really necesary for the portable research software dev model.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//11/26/coreos-cluster-gotchas.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="col-md-3">
          <header><h4><a href="/2014//11/24/coreos-docker-registries-etc.html">Coreos Docker Registries Etc</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 24 Nov 2014</p>

<article>
<div class="excerpt">
<h2 id="a-secure-docker-registry">A secure docker registry</h2>
<p>Running one’s own docker registry is far more elegant than moving tarballs between machines (e.g. when migrating between servers, particularly for images that may contain sensitive data such as security credentials). While it’s super convenient to have a containerized version of the Docker registry ready for action, it doesn’t do much good without putting it behind an HTTPS server (otherwise we have to restart our entire docker service with the insecure flag to permit communication with an unauthenticated registry – doesn’t sound like a good idea). So this meant learning how to use <code>nginx</code> load balancing, which I guess is useful to know more generally.</p>
<h3 id="first-pass-nginx-on-ubuntu-server">First pass: nginx on ubuntu server</h3>
<p>After a few false starts, decided the <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-14-04">digitalocean guide</a> is easily the best (though steps 1-3 can be skipped by using a containerized <code>registry</code> instead). This runs <code>nginx</code> directly from the host OS, which is in some ways more straight forward but less portable. A few notes-to-self in working through the tutorial:</p>
<ul>
<li><p>Note: At first, nginx refuses to run because there’s was <code>default</code> configuration in <code>cd /etc/nginx/sites-enabled</code> that tries to create a conflict. Remove this and things go pretty nicely.</p></li>
<li><p>Note: Running the registry container explicitly on port <code>127.0.0.1</code> provides an internal-only port that we can then point to from nginx. (Actually this will no longer matter when we use a containerized <code>nginx</code>, since we will simply not export these ports at all, but only expose the port of the <code>nginx</code> load balancer). Still, good to finally be aware of the difference between <code>127.0.0.1</code> and <code>0.0.0.0</code> (the publicly visible localhost, and the default if we supply only a port) in this context.</p></li>
<li><p>Note: Running and configuring <code>nginx</code> Note that keys are specific to the url. This is necessary for the server signing request, but I believe could have been omitted in the root certificate. Here’s how w ego about creating a root key and certificate (<code>crt</code>), a server key, server signing request (<code>csr</code>), and then sign the latter with the former to get the server certificate.</p></li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">openssl</span> genrsa -out dockerCA.key 2048
<span class="kw">openssl</span> req -x509 -new -nodes -key dockerCA.key -days 10000 -out dockerCA.crt -subj <span class="st">&#39;/C=US/ST=Oregon/L=Portland/CN=coreos.carlboettiger.info&#39;</span>
<span class="kw">openssl</span> genrsa -out docker-registry.key 2048
<span class="kw">openssl</span> req -new -key docker-registry.key -out docker-registry.csr -subj <span class="st">&#39;/C=US/ST=Oregon/L=Portland/CN=coreos.carlboettiger.info&#39;</span>
<span class="kw">openssl</span> x509 -req -in docker-registry.csr -CA dockerCA.crt -CAkey dockerCA.key -CAcreateserial -out docker-registry.crt -days 10000</code></pre>
<p>Note that we also need the <code>htpasswd</code> file from above, which needs <code>apache2-utils</code> and so cannot be generated directly from the CoreOS terminal (though the <code>openssl</code> certs can):</p>
<pre><code>sudo htpasswd -bc /etc/nginx/docker-registry.htpasswd $USERNAME $PASSWORD</code></pre>
<p>Having created these ahead of time, I end up just copying my keys into the Dockerfile for my <code>nginx</code> instance (if we generated them on the container, we’d still need to get <code>dockerCA.crt</code> off the container to authenticate the client machines. Makes for a simple Dockerfile that we then build locally:</p>
<pre><code>FROM ubuntu:14.04
RUN apt-get update &amp;&amp; apt-get install -y apache2-utils curl nginx openssl supervisor
COPY docker-registry /etc/nginx/sites-available/docker-registry
RUN ln -s /etc/nginx/sites-available/docker-registry /etc/nginx/sites-enabled/docker-registry

## Copy over certificates ##
COPY docker-registry.crt /etc/ssl/certs/docker-registry 
COPY docker-registry.key /etc/ssl/private/docker-registry 
COPY docker-registry.htpasswd /etc/nginx/docker-registry.htpasswd


EXPOSE 8080

## use supervisord to persist
COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf
CMD [&quot;/usr/bin/supervisord&quot;]</code></pre>
<p>Note that we need to install the <code>dockerCA.crt</code> certificate on any client that wants to access the private registry. On Ubuntu this looks like:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> mkdir /usr/local/share/ca-certificates/docker-dev-cert
<span class="kw">sudo</span> cp devdockerCA.crt /usr/local/share/ca-certificates/docker-dev-cert
<span class="kw">sudo</span> update-ca-certificates 
<span class="kw">sudo</span> service docker restart</code></pre>
<p>But on CoreOS we use a different directory (and restarting the docker service doesn’t seem possible or necessary):</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">sudo</span> cp dockerCA.crt /etc/ssl/certs/docker-cert
<span class="kw">sudo</span> update-ca-certificates  </code></pre>
<ul>
<li><p>Note: Could not get the official <code>nginx</code> container to run the <code>docker-registry</code> config file as <code>/etc/nginx/nginx.conf</code>, either with or without adding <code>daemon off;</code> at the top of <code>/etc/nginx/nginx.conf</code>. With, it complains this is a duplicate, (despite being recommended on the <a href="https://registry.hub.docker.com/_/nginx">nginx container documentation</a>, though admittedly this already appears in the default command <code>[&quot;nginx&quot; &quot;-g&quot; &quot;daemon off;&quot;]</code>). Without, the error says that <code>upstream</code> directive is not allowed here. Not sure what to make of these errors, ended up running an ubuntu container and then just installing <code>nginx</code> etc following the digitalocean guide. Ended up dropping the <code>daemon off;</code> from the config file and running <code>service nginx start</code> through <code>supervisord</code> to ensure that the container stays up. Oh well.</p></li>
<li><p>Note: I got a 502 error when calling <code>curl</code> against the the <code>nginx</code> container-provided URL (with or without SSL enabled), since from inside the <code>nginx</code> container we cannot access the host addresses. The simplest solution is to add <code>--net=&quot;host&quot;</code> when we <code>docker run</code> the <code>nginx</code> container, but this isn’t particularly secure. Instead, we’ll link directly to the ports of the <code>registry</code> container like this:</p></li>
</ul>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> run  --name=registry -p 8080:8080 registry
<span class="kw">docker</span> run --name=nginx --net=container:registry nginx</code></pre>
<p>Note that we do not need to export the registry port (e.g. <code>-p 5000:5000</code>) at all, but we do need to export the <code>nginx</code> load-balancer port <em>from the <code>registry</code> container</em> first, since we will simply be linking it’s network with the special <code>--net=container:registry</code>.</p>
<p>Note that we would probably want to link a local directory to provide persistent storage for the <code>registry</code>; in the above example images committed to registry are lost when the container is destroyed.</p>
<p>We can now log in:</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">docker</span> login https://<span class="kw">&lt;</span>YOUR-DOMAIN<span class="kw">&gt;</span>:8080</code></pre>
<p>We can now reference our private registry by using its full address in the namespace of the image in commands to <code>docker pull</code>, <code>push</code>, <code>run</code> etc.</p>
<h2 id="migrating-gitlab-between-servers">Migrating gitlab between servers</h2>
<p>This migration was my original motivation to configure the private docker registry; ironically it isn’t necessary for this case (though it’s useful for the drone image, for instance).</p>
<p>Note that there is no need to migrate the redis and postgresql containers manually. Migrating the backup file over to the corresponding location in the linked volume and then running the backup-restore is sufficient. Upgrading is also surprisingly smooth; we can backup (just in case), then stop and remove the container (leaving the <code>redis</code> and <code>postgresql</code> containers running), pull and relaunch with otherwise matched option arguments and the upgrade runs automatically.</p>
<p>When first launching the <code>gitlab</code> container on a tiny droplet running coreos, my droplet seems invariably to hang. Rebooting from the digitalocean terminal seems to fix this. A nice feature of <code>fleet</code> is that all the containers are restarted automatically after reboot, unlike when running these directly from <code>docker</code> on my ubuntu machine.</p>
<h2 id="notes-on-fleet-unit-files">Notes on fleet unit files</h2>
<p>Fleet unit files are actually pretty handy and straight forward. One trick is that we must quote commands in which we want to make use of environmental variables. For instance, one must write:</p>
<pre><code>Environment=&quot;VERSION=1.0&quot;
ExecStart=/bin/bash -c &quot;/usr/bin/docker run image:${VERSION}&quot;</code></pre>
<p>in a <code>Service</code> block, rather than <code>ExecStart=/usr/bin/docker run ...</code> directly, for the substitution to work. It seems if we are using the more standard practice of environment files (which after all is the necessary approach to avoid having to edit the unit file directly one way or another anyway), we can avoid the <code>bin/bash</code> wrapper and insert the environment reference directly.</p>
<p>If we’re not doing anything fancy wrt load balancing between different servers, we don’t have that much use for the corresponding “sidekick” unit files that keep our global <code>etcd</code> registry up to date. Perhaps these will see more use later.</p>
<h2 id="cloud-config">Cloud-config</h2>
<p>Note that we need to refresh the discovery url pretty-much anytime we completely destroy the cluster.</p>
<p>A few edits to my cloud-config to handle initiating swap, essential for running most things (gitlab, rstudio) on tiny droplets. Still requires one manual reboot for the allocation to take effect. Adds this to the <code>units</code> section of <code>#cloud-config</code>:</p>
<pre><code>    ## Configure SWAP as per https://github.com/coreos/docs/issues/52
    - name: swap.service
      command: start
      content: |
        [Unit]
        Description=Turn on swap

        [Service]
        Type=oneshot
        Environment=&quot;SWAPFILE=/1GiB.swap&quot;
        RemainAfterExit=true
        ExecStartPre=/usr/sbin/losetup -f ${SWAPFILE}
        ExecStart=/usr/bin/sh -c &quot;/sbin/swapon $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)&quot;
        ExecStop=/usr/bin/sh -c &quot;/sbin/swapoff $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)&quot;
        ExecStopPost=/usr/bin/sh -c &quot;/usr/sbin/losetup -d $(/usr/sbin/losetup -j ${SWAPFILE} | /usr/bin/cut -d : -f 1)&quot;

        [Install]
        WantedBy=local.target

    - name: swapalloc.service
      command: start
      content: |
        [Unit]
        Description=Allocate swap

        [Service]
        Type=oneshot
        ExecStart=/bin/sh -c &quot;sudo fallocate -l 1024m /1GiB.swap &amp;&amp; sudo chmod 600 /1GiB.swap &amp;&amp; sudo chattr +C /1GiB.swap &amp;&amp; sudo mkswap /1GiB.swap&quot;
</code></pre>
<p>More probably be structured more elegantly, but it works. (Not much luck trying to tweak this into a bunch of <code>ExecStartPre</code> commands though.</p>
<h2 id="nfs-sharing-on-coreos">NFS sharing on CoreOS?</h2>
<p>Couldn’t figure this one out. <a href="https://serverfault.com/questions/647014/share-disks-through-nfs-on-a-coreos-cluster">My SO Q here</a></p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//11/24/coreos-docker-registries-etc.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//11/19/coreos-and-other-infrastructure-notes.html">Coreos And Other Infrastructure Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 19 Nov 2014</p>

<article>
<div class="excerpt">
<h2 id="coreos">CoreOS?</h2>
<p>Security model looks excellent. Some things not so clear:</p>
<ul>
<li><p>In a single node setup, what happens with updates? Would containers being run directly come down and not go back up automatically? In general, how effective or troublesome is it to run a single, low-demand app on a single node CoreOS rather than, say, an ubuntu image (e.g. just to benefit from the security updates model)? For instance, would an update cause a running app to exit in this scenario? (Say, if the container is launched directly with <code>docker</code> and not through <code>fleet</code>?) (Documentation merely notes that cluster allocation / fleet algorithm is fastest with between 3 &amp; 9 nodes).</p></li>
<li><p>If I have a heterogenous cluster with one more powerful compute node, is there a way to direct that certain apps are run on that node and that other apps are not?</p></li>
<li><p>Looks like one needs a load-balancer to provide a consistent IP for containers that might be running on any node of the cluster?</p></li>
<li><p><a href="https://github.com/coreos/docs/issues/52">Enabling swap</a>. Works, but is there a way to do this completely in <code>cloud-config</code>?</p></li>
</ul>
<h2 id="setting-up-my-domain-names-for-digitalocean">Setting up my domain names for DigitalOcean</h2>
<p>In Dreamhost DNS management:</p>
<ul>
<li>I have my top-level domain registered through Dreamhost, uses dreamhost’s nameservers.</li>
<li>A-level entry for top level domain points to (the new) Github domain IP address</li>
<li>Have CNAME entries for <code>www</code> and <code>io</code> pointing to <code>cboettig.github.io</code></li>
</ul>
<p><strong>First step</strong></p>
<ul>
<li>Add an A-level entry, <code>server.carlboettiger.info</code>, pointing to DigitalOcean server IP</li>
</ul>
<p>Then go over to DigitalOcean panel.</p>
<p>From DigitalOcean DNS management:</p>
<ul>
<li>add new (A level) DNS entry as <code>server.carlboettiger.info</code> pointing to DO server IP</li>
<li>Delete the existing three NS entries <code>ns1.digitalocean.com</code> etc.</li>
<li>Add three new NS entries using <code>ns1.dreamhost.com</code> etc</li>
</ul>
<p>Things should be good to go!</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//11/19/coreos-and-other-infrastructure-notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="col-md-3">
          <header><h4><a href="/2014//11/17/wssspe-feedback.html">Wssspe Feedback</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 17 Nov 2014</p>

<article>
<div class="excerpt">
<h3 id="wssspe-working-groups-reproducibility-reuse-and-sharing-neil-che-hong">WSSSPE working groups: Reproducibility, Reuse, and Sharing (Neil Che Hong)</h3>
<p>Our group focused on journal policies regarding software papers. Our objectives were:</p>
<ul>
<li><p>A Survey of journals that publish software papers. The Software Sustainability Institute already maintains <a href="https://www.software.ac.uk/resources/guides/which-journals-should-i-publish-my-software">a list</a></p></li>
<li><p>A summary of policies each of these journals has in place regarding software papers. (e.g. licensing requirements, repository requirements, required sections in the manuscripts regarding installation or tests, etc).</p></li>
<li><p>Developing a five-star rating system for ranking these policies.</p></li>
<li><p>Apply our rating system to each of these journals.</p></li>
<li><p>Solicit feedback &amp; iterate.</p></li>
</ul>
<p>We got about half way though this for some of the most recognized journals on the list; <a href="https://docs.google.com/document/d/1Mivadj16_9tPrw8Nxmhp72AtNC0BEVO-f7M84FXTbSU/edit?usp=drive_web">see Google Doc notes</a>.</p>
<h3 id="feedback-for-wssspe">Feedback for WSSSPE:</h3>
<p>WSSSPE’s conference-proceedings model of submitting a short papers that get five very thorough expert reviews ahead of time is really excellent. This is not common practice in my field, so this was my first time participating in such a model. Not only did I benefit from both the chance to write up our piece ahead of time and get expert feedback from people coming from a broader range of backgrounds than I can usually interact with, but also the ability to read the full papers and not just the abstracts of other attendees in advance of the workshop was an invaluable way to learn more, make the most of the time we had, and keep a record.</p>
<p>A full-day workshop is a big travel commitment (travel costs, 2 nights lodging, and using up most of the preceding and following day) while simultaneously being not much time to meet people, share ideas, and start working towards any actual products.</p>
<p>The format proposed at the end of the session that seemed most popular in the show of hands for future WSSSPEs – a two to three day event uncoupled from Supercomputing, based in the US in an easy city to fly into, and with more time to move ideas forward into products using a small group / hackathon model would address most of my criticsm.</p>
<h3 id="misc-notesdiscussions">Misc notes/discussions</h3>
<ul>
<li><p>Interesting discussion/ideas for tracking usage of software based on updating patterns, from James Horowitz and company: <a href="https://james.howison.name/pubs/wiggins2009heartbeat-meas0.pdf">Heartbeat (pdf)</a>.</p></li>
<li><p>Neil mentioned a similar workshop he had recently taken part in creating a <a href="https://m.f1000research.com/articles/3-271/v1">reviewer’s oath</a>, recently submitted as an opinion piece to F1000. Certainly more of a guideline than most journals give, if a bit pedantic at times (for instance, as much as I believe in signing my own reviews, I would not recommend it to someone else as a blanket policy in the same vein as basic ethics like acknowledging what I don’t know. I think the ‘Oath’ needs to treat this with greater nuiance.) Anyway, food for thought.</p></li>
</ul>
<p>(I didn’t manage to catch much with twitter this time, guess too much happening in in-person discussions).</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2014//11/17/wssspe-feedback.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row socialicons">
  <div class="col-md-11 col-md-offset-1">
		<p> <a href="/2014/index.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/2014/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/2014/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
  </div> <!--end col-md-9 -->
</div> <!--end row -->




      <footer class="footer">

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="https://www.carlboettiger.info#me">
      <p>
          <script type="text/javascript" src="/assets/js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="fa fa-google-plus"></i></a>

          <a rel="foaf:account" href="https://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" /></a> 

           citations on google-scholar

           stackoverflow
      -->
      <a rel="foaf:weblog" type="application/atom+xml" href="/blog.xml"  
         class="showtooltip" title="RSS feeds for my blog-style entries. See the feed on my lab notebook (/atom.xml) to follow all entries instead." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    <!--**************** End social links **************************** -->


    <div class="col-md-4 col-md-offset-1 col-xs-4">
      <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="https://onsclaims.wikispaces.com/"><img src="/assets/img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="https://creativecommons.org/ns#license" href="https://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="/assets/img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>


  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=https://www.carlboettiger.info/lab-notebook.html">
  </span>


</footer>




          <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <!-- JQuery, used on a few pages (still?) -->
    <!-- <script type="text/javascript" src="/assets/js/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <!--  <script src="/assets/js/bootstrap.min.js"></script> -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>


    

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    </div>
  </body>
</html>
   
