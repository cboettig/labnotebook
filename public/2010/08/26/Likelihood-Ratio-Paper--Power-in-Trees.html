<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#"> <!-- namespaces used in metadata.html -->
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Likelihood Ratio Paper- Power in Trees</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- HTML5 metadata -->
<meta name="keywords" content="pmc" />
<meta name="description" content="" />
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Likelihood Ratio Paper- Power in Trees" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="2010-08-26 00:00:00 +0000" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/08/26/Likelihood-Ratio-Paper--Power-in-Trees.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Likelihood Ratio Paper- Power in Trees" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="2010-08-26 00:00:00 +0000" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/08/26/Likelihood-Ratio-Paper--Power-in-Trees.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<!--
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content="2010-08-26 00:00:00 +0000"/>
<meta name="citation_title" content="Likelihood Ratio Paper- Power in Trees"/>
<meta name="citation_journal_title" content="Lab Notebook"/>
-->
<!--NOTE: see also the COinS Metadata in span element in footer -->




	<link href="http://www.carlboettiger.info/assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <!-- Help the browser identify the RSS feed automatically -->
  <link rel="alternate" type="application/rss+xml" title="Carl Boettiger's Lab Notebook" href="/blog.xml" />
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    <!-- Navbar  ================================================== -->

<nav class="navbar navbar-default" role="navigation">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/README.html"><i class="icon-info-sign"></i></a>
    </div>

 <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

          <li  >
          <a href="/index.html">Home</a></li>
          <li  >
          <a href="/vita.html">Vita</a></li>
          <li  >
          <a href="/research.html">Research</a></li>
          <li  >
          <a href="/teaching.html">Teaching</a></li>
          <li  >
          <a href="/community.html">Community</a></li>
          <li  >
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>

      <!-- Search site using Google's index -->
        <form class="navbar-form navbar-right" role="search" method="get" action="http://google.com/search">
          <div class="form-group">
            <input type="hidden" name="q" value="site:carlboettiger.info" />
            <input type="text" class="form-control search-query" name="q" placeholder="Search"/>
          </div>
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
       </form>

    </div><!--/.nav-collapse -->
  </div> <!-- /container -->
</nav>



    <div class="container"> <!-- Responsive grid layout, doesn't jump to full-width --> 
      <header>
        <h1 class="entry-title">Likelihood Ratio Paper- Power in Trees</h1>
        <h2></h2>
      </header>

      <div class="row">
  <div class="col-md-7 col-md-offset-1">
    <article>
    <p><br /> ### Power in Trees tests (Results from single OU simulation per alpha, run yesterday)</p>
<p>2000 replicates gives a cleaner picture of the critical alpha, though with low alpha values the estimates of p are quite variable. Also more variable on the smaller trees. Even arbitrarily large alpha aren’t significant on the 5-taxa primate tree. On the small geospiza tree (13 taxa) from the geiger package we find:</p>
<pre class="de1"><code>0.5735   0.29  0.704 0.6465  0.993  0.838 0.8605 0.9355  0.782  0.845   0.93 
 &quot;0.1&quot;  &quot;0.2&quot;  &quot;0.3&quot;  &quot;0.4&quot;  &quot;0.5&quot;  &quot;0.6&quot;  &quot;0.7&quot;  &quot;0.8&quot;  &quot;0.9&quot;    &quot;1&quot;    &quot;2&quot; 
 0.945 0.9985  0.958 0.7725 0.9995  0.982  0.949  0.992      1   0.99  0.999 
   &quot;3&quot;    &quot;4&quot;    &quot;5&quot;    &quot;6&quot;    &quot;7&quot;    &quot;8&quot;    &quot;9&quot;   &quot;10&quot;   &quot;20&quot;   &quot;30&quot;   &quot;40&quot; 
0.9895 
  &quot;50&quot;</code></pre>
<p>P values on top row, alpha values in quotes below the p value. Notice 9 fails to be significant at 0.95% confidence level, though might as easily be somewhere around 6. For the Labrid tree with 114 taxa the pattern is clearer though not perfect:</p>
<pre class="de1"><code> 0.621  0.502 0.9735   0.66 0.5185 0.8075 0.9975 0.9665  0.907  0.997 0.9945 
 &quot;0.1&quot;  &quot;0.2&quot;  &quot;0.3&quot;  &quot;0.4&quot;  &quot;0.5&quot;  &quot;0.6&quot;  &quot;0.7&quot;  &quot;0.8&quot;  &quot;0.9&quot;    &quot;1&quot;    &quot;2&quot; 
     1      1      1      1      1      1      1      1      1      1      1 
   &quot;3&quot;    &quot;4&quot;    &quot;5&quot;    &quot;6&quot;    &quot;7&quot;    &quot;8&quot;    &quot;9&quot;   &quot;10&quot;   &quot;20&quot;   &quot;30&quot;   &quot;40&quot; 
     1 
  &quot;50&quot;</code></pre>
<p>Significance clearly sets in between alpha of 0.9 and 1.</p>
<p>Summary:</p>
<pre class="de1"><code>&gt; birds$min_alpha
[1] 10
13 taxa
&gt; primates$min_alpha
[1] 1000
(5 taxa)
&gt; carnivora$min_alpha
[1] 1
260 taxa
&gt; labrids$min_alpha
[1] 1
114 taxa
&gt; carex$min_alpha
[1] 2
53 taxa
&gt;</code></pre>
<h4 id="reducing-the-noise-in-the-power-estimation">reducing the noise in the power estimation</h4>
<p>I’ve just implemented the power test for the smallest alpha that can be detected at the 95% level using the (whatarewecallingitnow) likelihood ratio monte carlo approach on a given tree. I try simulating under successively higher alpha values and then see if the resulting dataset can be distinguished. In my first implementation, this involves only one simulation from the OU model at a given alpha, and then the N bootstrap simulations from the null brownian model per alpha.</p>
<p>Obviously I want more than one simulation from the OU process. It seems I could (1) simulate under the OU model of a given alpha, (2) fit the BM model to the resulting data, (3) simulate under that BM model to get the “bootstrap” data, for which (4) I refit the BM and OU models and compare the likelihood ratio of these refit models. That sounds pretty convoluted when I describe it that way, but I think this is the “natural” thing to do? i.e. steps 2-4 are the bootstrap process which I normally repeat N times for a single dataset, now instead of using a single dataset I draw a dataset from the distribution….</p>
<p><br /> New approach: multiple simulations from alpha ———————————————</p>
<h4 id="plots-show-decreasing-power-with-decreasing-alpha">Plots show decreasing power with decreasing alpha</h4>
<figure>
<img src="http://openwetware.org/images/thumb/e/ec/Power_alpha5.png/180px-Power_alpha5.png" alt="Anoles data at alpha=25. Red curve is the LR distribution when simulations come from OU with alpha=25, blue line is LR distribution when simulations come from BM models fit to those OU-generated data" /><figcaption>Anoles data at alpha=25. Red curve is the LR distribution when simulations come from OU with alpha=25, blue line is LR distribution when simulations come from BM models fit to those OU-generated data</figcaption>
</figure>
<figure>
<img src="/skins/common/images/magnify-clip.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>Anoles data at alpha=25. Red curve is the LR distribution when simulations come from OU with alpha=25, blue line is LR distribution when simulations come from BM models fit to those OU-generated data</p>
<figure>
<img src="http://openwetware.org/images/thumb/9/9a/Power_alpha1.png/180px-Power_alpha1.png" alt="Anoles data at alpha=1." /><figcaption>Anoles data at alpha=1.</figcaption>
</figure>
<figure>
<img src="/skins/common/images/magnify-clip.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>Anoles data at alpha=1.</p>
<figure>
<img src="http://openwetware.org/images/thumb/7/79/Power_alpha.png/180px-Power_alpha.png" alt="Anoles data at alpha=0.25." /><figcaption>Anoles data at alpha=0.25.</figcaption>
</figure>
<figure>
<img src="/skins/common/images/magnify-clip.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>Anoles data at alpha=0.25.</p>
<p><br /> New procedure:</p>
<pre class="de1"><code>   ## Draw a data sample from the distribution produced by test
    data &lt;- simulate(test, n=nboot)
 
    ## fit the null models to these data -- so we simulate from the appropriate null
    nulls &lt;- lapply(1:nboot, function(i){
            update(null, data[[i]])
    })
    tests &lt;- lapply(1:nboot, function(i){
            update(test, data[[i]])
    })
    t0_dist &lt;- sapply(1:nboot, function(i){
        if(is(tests[[i]], &quot;hansentree&quot;)){ t0 &lt;- -2*(nulls[[i]]@loglik - tests[[i]]@loglik) }
        else { t0 &lt;- -2*(nulls[[i]]@loglik - tests[[i]]$loglik) }
    })
 
 
    ## Data come from a distribution of nulls, 
    X &lt;- sapply(1:nboot, function(i){
        simulate(nulls[[i]])
    })
 
    t &lt;- sapply(1:nboot, function(i){
        refit_null &lt;- update(null, X[[i]])
        refit_test &lt;- update(test, X[[i]])
        if(is(refit_test, &quot;hansentree&quot;)){ out &lt;- -2*(refit_null@loglik - refit_test@loglik) }
        else { out &lt;- -2*(refit_null@loglik - refit_test$loglik) }
        out
    })
 
 plot(density(out$t), col=&#39;blue&#39;, lwd=3,xlim=range(c(out$t0_dist,out$t)) )
 lines(density(out$t0_dist), col=&#39;red&#39;, lwd=3)</code></pre>
<figure>
<img src="http://openwetware.org/images/thumb/4/4b/Null_LR.png/180px-Null_LR.png" alt="Null distributions of the LR all lie on top of eachother regardless of sigma" /><figcaption>Null distributions of the LR all lie on top of eachother regardless of sigma</figcaption>
</figure>
<figure>
<img src="/skins/common/images/magnify-clip.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>Null distributions of the LR all lie on top of eachother regardless of sigma</p>
<p>From these it is possible to estimate the power (see <a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/6f6c8d70d342761e508e949f710aced716ddf472/R/powertest.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/6f6c8d70d342761e508e949f710aced716ddf472/R/powertest.R">powertest.R code</a>)</p>
<p><br /> Note that the null distribution (the blue curve) doesn’t actually differ and so doesn’t need to be re-simulated with different values.</p>
<p><br /> <img src="http://openwetware.org/images/thumb/c/c1/Anoles_power.png/180px-Anoles_power.png" alt="anoles power" /></p>
<figure>
<img src="/skins/common/images/magnify-clip.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>anoles power</p>
<p><br /> Meanwhile ———</p>
<ul>
<li>Finishing the story on model choice in the Anoles dataset. Resimulating with extra replicates and including all 5 original models.</li>
<li>Good news is that 2000 bootstraps on all 6 models against each other is quite fast on the 16-processor <em>zero</em>, an hour or so. Bad news is the ou2 funny painted model isn’t bootstrapping the LR correctly, though all the other pairs are.</li>
<li>Other sorta bad news is that OU_LP does a handy job at beating all other models under Monte Carlo Likelihood Ratio test, so the final conclusion doesn’t have the punchiness a contradiction would. At least the contrived OU2 contradicts this. Should also add the “all different” painting to the mix to demonstrate. –Carl Boettiger 01:24, 27 August 2010 (EDT) Fixed, order of nodes conflicted.</li>
</ul>
<h4 id="slideshow-of-results">Slideshow of results</h4>
<p><a href="http://photobucket.com/redirect/album?showShareLB=1"><img src="http://pic.pbsrc.com/share/icons/embed/btn_geturs.gif" alt="image" /></a><a href="http://s1212.photobucket.com/albums/cc458/cboettig/"><img src="http://pic.pbsrc.com/share/icons/embed/btn_viewall.gif" alt="image" /></a></p>
<h2 id="code-updates">Code updates</h2>
<p>–Carl Boettiger 03:26, 27 August 2010 (EDT)</p>
<ul>
<li><p>Just implemented the fast version of the power test, which avoids re-simulating from the Brownian motion null, and handles the parallelization with more finesse, and as a single function. Set to run examples overnight.</p></li>
<li><p>Removed the traitmodels support from the power test for the moment, until the convergence issues are dealt with. The s3/s4 class differences to access elements make this annoying as method dependency must be handled explicitly by if statements not automatically by class generics. (guess could access by index? – Nope, S4 classes aren’t subsettable)</p></li>
</ul>
<h4 id="updated-power-curves-for-trees">Updated power curves for trees</h4>
<p>Using the faster approach avoiding re-sampling the null distribution for each alpha, I generate power curves for trees of different sizes and complexity. The larger, richer trees show more power.</p>
<ul>
<li><a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/916ec3622b5b51578c2fe871584f1846b1bddf1f/R/powertest.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/916ec3622b5b51578c2fe871584f1846b1bddf1f/R/powertest.R">Code for method</a></li>
<li><a href="http://github.com/cboettig/Comparative-Phylogenetics/blob/83e0ecf41603d4f6280f9e497be89c152e661107/demos/power_examples.R" title="http://github.com/cboettig/Comparative-Phylogenetics/blob/83e0ecf41603d4f6280f9e497be89c152e661107/demos/power_examples.R">Code for example</a></li>
</ul>
<figure>
<img src="http://openwetware.org/images/d/d8/Fast_power_examples.png" alt="Image:Fast_power_examples.png" /><figcaption>Image:Fast_power_examples.png</figcaption>
</figure>
<p><br /></p>

    </article>
  </div>
  <div class="col-md-4">
    <div class="sidebar">
      <aside prefix="og:http://ogp.me/ns/article#">
  <p> <i class="icon-calendar"></i>
    <time datetime="2010-08-26 00:00:00 +0000" 
    property="dc:created">26 Aug 2010</time></p>
   

 <br />

  
	<p><a class="btn btn-default" rel="prev" href='/2010/08/25/Likelihood-Ratio-Manuscript.html'><i class="icon-chevron-left"></i> prev</a>
  
  
  <a class="btn btn-default" rel="next" href='/2010/08/27/Likelihood-ratio-ToDo.html'>next <i class="icon-chevron-right"></i></a></p>
  

  <br />

  <p> <a  onclick="recordOutboundLink(this, 'Outbound Links', 'history'); 
            return false;" 
          class="btn btn-default" 
          href="https://github.com/cboettig/2010/commits/master/_posts/2010-08-26-Likelihood-Ratio-Paper--Power-in-Trees.md"><i class="icon-time"></i> history</a></p>

  <br />

  <p><i class="icon-list"></i> Posted in 
     
      <a rel="dc:subject" class="category" 
         href="/2010/categories.html#evolution">evolution</a>
    
    </p>

  <p> <i class="icon-tag"></i> tags: 
    
    <!-- http://schema.org/BlogPosting/keywords -->
    <a rel="og:tag" class="tag" 
			href="/2010/tags.html#pmc">#pmc</a>
    </p>

  <br/>

  

  <br/>
  <p><small> <i class="icon-barcode"></i> SHA Hash: <a href="https://github.com/cboettig/2010/commit/3093a1add03eedc30e9635dd4a0b91f5991c28b1/_posts/2010-08-26-Likelihood-Ratio-Paper--Power-in-Trees.md"> 3093a1add03eedc30e9635dd4a0b91f5991c28b1</a></small></p>
    
  <br/>
  

</aside>

    </div>
  </div>
</div>

      <!-- Disqus Comments -->
      <div class="row disqus">
        <div class="col-md-8">          
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'cboettig'; // required: replace example with your forum shortname
                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
      </div>






      <footer class="footer">

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="col-md-3 col-xs-4 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <script type="text/javascript" src="/assets/js/obfuscate-email-link.js"></script> 

          <a rel="foaf:account" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="fa fa-twitter"></i></span></a> 

          <a rel="foaf:account" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="fa fa-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="fa fa-google-plus"></i></a>

          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" /></a> 

           citations on google-scholar

           stackoverflow
      -->
      <a rel="foaf:weblog" type="application/atom+xml" href="/blog.xml"  
         class="showtooltip" title="RSS feeds for my blog-style entries. See the feed on my lab notebook (/atom.xml) to follow all entries instead." 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="fa fa-rss"></i></a>
       </p>
    </div>

    
    <!--**************** End social links **************************** -->


    <div class="col-md-4 col-md-offset-1 col-xs-4">
      <p><a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="/assets/img/ons-aci2-icon.svg" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a></p>
    </div>


    <div class="col-md-3 col-md-offset-1 col-xs-4">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="/assets/img/cc-zero.svg" alt="CC0"/></a> 
      </p>
    </div>
  </div>


  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Likelihood Ratio Paper- Power in Trees
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=2010-08-26
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/08/26/Likelihood-Ratio-Paper--Power-in-Trees.html">
  </span>


</footer>




          <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <!-- JQuery, used on a few pages (still?) -->
    <!-- <script type="text/javascript" src="/assets/js/jquery.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <!--  <script src="/assets/js/bootstrap.min.js"></script> -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>


    

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    </div>
  </body>
</html>
   
